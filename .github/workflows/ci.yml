name: .NET Build & UnitTests

on:
  workflow_dispatch:
  push:
    branches: [ main ]
    paths:
      - "src/**"
  pull_request:
    branches: [ main ]
    paths:
      - "src/**"

jobs:
  build-and-test:

    strategy:
      matrix:
        configuration: [ Release ]
        include:
          - os: windows-latest
            osName: Windows
          - os: ubuntu-latest
            osName: ubuntu

    name: ğŸš€ [${{ matrix.configuration }}] Build and Test on ${{ matrix.osName }}
    runs-on: ${{ matrix.os }}
    steps:
      - name: ğŸ›’ Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: âœ¨ Set up .NET 6.0
        uses: actions/setup-dotnet@v2
        with:
          dotnet-version: 6.0.x

      - name: ğŸšš Restore dependencies
        working-directory: src
        run: dotnet restore

      - name: ğŸ› ï¸ Build
        working-directory: src
        run: dotnet build --configuration $env:Configuration --no-restore
        env:
          Configuration: ${{ matrix.configuration }}

      - name: ğŸ§ª Test
        working-directory: src
        run: dotnet test --configuration $env:Configuration --no-build --verbosity normal --filter Category!=local
        env:
          Configuration: ${{ matrix.configuration }}
